{% extends "base.html" %}

{% block head %}
<title>OxBus | Nearby stops</title>
{% endblock %}

{% block body %}

{% if stop_list %}
<section id="content">
  <ul id="item-list">
  {% for stop in stop_list %}
    {% if stop['buses'] %}
      <li>
          <a class ="details" href="/stop/{{ stop.atco }}" title="More about {{ stop.name }}">
            <h2 class="stopname">{{ stop['name'] }}</h2>
            <div class="location">
            <h4>{{ stop['distance'] }} metres away</h4>
            <h4 class="show-map">Show on map</h4>
            </div>
            <div class="spacer"></div>
          </a>
          <div class="buses">
            <a class="show-more" title="Show/hide" onclick="toggle_visibility('{{ loop.index }}');">
            <div class="nextbus">
              <div class="service">
                <h4>{{ stop.buses[0].service }}</h4>
              </div>
              <div class="businfo">
                <p>To {{ stop.buses[0].destination }}</p>
                <p class="time">{{ stop.buses[0].minutes_to_departure }} minutes away</p>
              </div>
              <h4 class="show-more">Show later buses</h4>
            </div>
            </a>
            <div class="bus-list" id="{{ loop.index }}">
            <h4>Later buses:</h4>
            <ul>
              {% if stop.buses[1:] %}
                {% for bus in stop.buses[1:] %}
                  <li class="bus">
                    <div class="service">
                      <h4>{{ bus.service }}</h4>
                    </div>
                    <div class="businfo">
                      <p>To {{ bus.destination }}</p>
                      <p class="time">{{ bus.minutes_to_departure }} minutes away</p>
                    </div>
                  </li>
                {% endfor %}
              {% else %}
                <p>No more buses in the next hour :(</p>
              {% endif %}
            </ul>
            <div class="spacer"></div>
            </div>
          </div>
      </li>
    {% else %}
      <li>
        <div class="details">
          <h2 class="stopname">{{ stop['name'] }}</h2>
          <div class="location"> 
            <h4>{{ stop['distance'] }} metres away</h4>
          </div>
          <div class="spacer"></div>
        </div>
        <div class="buses">
        <p>No more buses in the next hour</p>
        </div>
      </li>
    {% endif %}
  {% endfor %}
  </ul>
</section>

{% if more == True %}
<section id="load-more">
<a onclick="offset = loadMore(offset);">
  <h3>Tap to load more</h3>
</a>
</section>
{% endif %}

<section id="postcode-instead">
  <p>Results don't look right? <a href="/postcode/" title="search by postcode">Search by postcode instead...</a></p>
</section>
{% else %}
<section id="location">
  <h2>Oh dear, we couldn't find any bus stops near you!</h2>
  <h3>Use the form below if you'd like to search by postcode:</h3>
  <form method="POST" action="/postcode/">
    <fieldset id="postcode">
      <label for="postcode">Postcode:</label>
      <input type="text" name="postcode" id="postcode"></input>
    </fieldset>
    <input type="submit" value="Submit" id="submit"></input>
  </form>
</section>
{% endif %}
{% endblock %}

{% block script%}
<script type="text/javascript">
function toggle_visibility(id) 
{
  var e = document.getElementById(id);
  if(e.style.display == 'block')
  {
    e.style.display = 'none';
  }
  else
  {
    e.style.display = 'block';
  }
}

var collection = document.getElementsByClassName('bus-list');
for(var i=0; i<collection.length; i++)
{
  collection[i].style.display = 'none';
}
</script>

{% if more == True %}
<script src="/static/js/load-more.js"></script>
{% endif %}
{% endblock %}